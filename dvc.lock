schema: '2.0'
stages:
  preprocess:
    cmd: python3 -u preprocessing.py
    deps:
    - path: data/raw-area-responses/
      hash: md5
      md5: 7ab2ba1f341828f2187ee0f729b55fcf.dir
      size: 1154300328
      nfiles: 2
    - path: preprocessing.py
      hash: md5
      md5: 832cd232344d6e03c5355222e4024265
      size: 966
    params:
      params.yaml:
        preprocess:
          areas:
          - VISp
          - VISl
          lag-time: 0
          lag-area: ''
          step-size: 0.05
          bin-size: 0.05
          stimulus-duration: 0.25
    outs:
    - path: data/area-responses/
      hash: md5
      md5: c2641c2488e885cadcb5d397621bae5b.dir
      size: 23086328
      nfiles: 2
  rrr_analysis:
    cmd: python3 -u rrr_analysis.py
    deps:
    - path: data/area-responses/
      hash: md5
      md5: 18a4a286fc913c2b7dca2a17b792fbe4.dir
      size: 27702328
      nfiles: 2
    params:
      params.yaml:
        cache:
          location: data/.vbn_s3_cache
          force_download: false
        rrr:
          cv: 5
          rank: 10
    outs:
    - path: results/rrr_coefficients.pickle
      hash: md5
      md5: 602969e22ae61fd2082ce408273d3275
      size: 360803
  plots:
    cmd: python3 -u cv-time-lag-plot.py
    deps:
    - path: cv-time-lag-plot.py
      hash: md5
      md5: 94c99302fd551b26e4a997234af1fcbb
      size: 1767
    - path: results/CV-lag-time.pickle
      hash: md5
      md5: dc8f282791f211819f63dc76090abf7e
      size: 1757
    params:
      params.yaml:
        preprocess:
          areas:
          - VISp
          - VISl
          lag-time: 0
          lag-area: ''
          step-size: 0.05
          bin-size: 0.05
          stimulus-duration: 0.25
        rrr:
          cv: 3
          rank: 18
          error-score: raise
          predictor: VISp
          target: VISl
          timepoint: 0.05
          sample-size: 15
        rrr-param-search:
          cv:
          - 2
          - 4
          - 6
          - 8
          - 10
          rank:
          - 5
          - 10
          - 15
          - 20
          - 25
          lag:
          - 0
          - 1
          timepoints:
          - 0
          - 50
          - 100
          - 150
    outs:
    - path: figures/rrr-param-search.png
      hash: md5
      md5: 5a8b554c28633782c559eab7f108ebd3
      size: 94061
  time_lag_analysis:
    cmd: python3 -u time_lag_analysis.py
    deps:
    - path: data/area-responses/
      hash: md5
      md5: c0d25e573c80757dee5540640262535b.dir
      size: 577559292
      nfiles: 3
    params:
      params.yaml:
        preprocess:
          areas:
          - VISp
          - VISl
          stimulus-block: 5
          bin-size: 0.005
          stimulus-duration: 0.25
        rrr:
          cv: 5
          rank: 10
    outs:
    - path: results/VISp_VISl_cross-time-coeffs.pickle
      hash: md5
      md5: 3ab7d9da547a0cfffcdb0b7bf2eec32f
      size: 20152
  analysis:
    cmd: python3 -u layer-rank-analysis.py
    deps:
    - path: analyses/layer_rank.py
      hash: md5
      md5: d80e5a52cc06d1af401c5d9660289fd3
      size: 4069
    - path: data/area-responses/
      hash: md5
      md5: c2641c2488e885cadcb5d397621bae5b.dir
      size: 23086328
      nfiles: 2
    - path: data/units/
      hash: md5
      md5: bae13c27578d80797c7a86c55f82a995.dir
      size: 3644
      nfiles: 2
    - path: layer-rank-analysis.py
      hash: md5
      md5: f44576886c0f20cebd06890abd8d0fb5
      size: 1544
    params:
      params.yaml:
        layer-rank:
          cv:
          - 2
          - 3
          - 4
          - 5
          - 6
          - 7
          - 8
          - 9
          - 10
          bestRank: 15
          minRank: 5
          maxRank: 25
          stepRank: 1
          timepoint: 100
        load:
          session: 0
          areas:
          - VISp
          - VISl
          stimulus-block: natural_scenes
          step-size: 0.001
          stimulus-duration: 0.25
        preprocess:
          areas:
          - VISp
          - VISl
          lag-time: 0
          lag-area: ''
          step-size: 0.05
          bin-size: 0.05
          stimulus-duration: 0.25
    outs:
    - path: results/layer-rank.pickle
      hash: md5
      md5: 0c5d43779ee19b535eefff5d586b014c
      size: 4077
  behav-preprocess:
    cmd: python3 -u behav-preprocessing.py
    deps:
    - path: behav-preprocessing.py
      hash: md5
      md5: 7451924b8d7170dc7280fb4455e536c4
      size: 1524
    params:
      params.yaml:
        preprocess:
          areas:
          - VISp
          - VISl
          stimulus-block: 5
          step-size: 0.025
          bin-size: 0.05
          stimulus-duration: 0.25
    outs:
    - path: data/behav-responses/
      hash: md5
      md5: 104453b33f55c1aeb16f66da4bcfefdd.dir
      size: 1151766
      nfiles: 3
  load:
    cmd: python3 -u load_raw_activity_data.py
    params:
      params.yaml:
        load:
          session: 0
          areas:
          - VISp
          - VISl
          stimulus-block: natural_scenes
          step-size: 0.001
          stimulus-duration: 0.25
    outs:
    - path: data/raw-area-responses/
      hash: md5
      md5: 7ab2ba1f341828f2187ee0f729b55fcf.dir
      size: 1154300328
      nfiles: 2
  dimensionality-reduction:
    cmd: python3 -u cv-lag-time-selection.py
    deps:
    - path: cv-lag-time-selection.py
      hash: md5
      md5: 965a07f1bed342b2c2fad2c2dde90119
      size: 886
    - path: results/CV-lag-time.pickle
      hash: md5
      md5: d0f0c894fa996641bec510dcc4f0ccdd
      size: 442
    outs:
    - path: results/CV-lag-time_max-mean.pickle
      hash: md5
      md5: 075529a1c01fe2f4196054b96158e56d
      size: 221
    - path: results/CV-lag-time_max-mean_name.pickle
      hash: md5
      md5: 1416be89675e4e1240eeb07b8c5cafbb
      size: 18
  imshow:
    cmd: python3 -u lags-along-time-plot.py
    deps:
    - path: lags-along-time-plot.py
      hash: md5
      md5: 57e2230b96272272e4d3509ddabea466
      size: 962
    - path: results/lags-along-time.pickle
      hash: md5
      md5: 86b4c9f1198ee40350cfe5101e557153
      size: 3352
    params:
      params.yaml:
        preprocess:
          areas:
          - VISp
          - VISl
          lag-time: 0
          lag-area: VISl
          step-size: 0.01
          bin-size: 0.1
          stimulus-duration: 0.25
        rrr-param-search:
          cv:
          - 3
          rank:
          - 14
          lag:
          - 0
          - 1
          - 2
          - 3
          - 4
          - 5
          - 6
          - 8
          - 10
          - 15
          - 20
          - 25
          - 30
          - 35
          - 40
          - 45
          timepoints:
          - 0
          - 100
          duration: 0.25
          time-bin: 0.05
          time-step: 0.025
    outs:
    - path: figures/lags-along-time.png
      hash: md5
      md5: 805bc6159cea03e97789675c123c5998
      size: 17841
  plot:
    cmd: python3 -u crosstime-plot.py
    deps:
    - path: crosstime-plot.py
      hash: md5
      md5: bd5ebae0b105f7c1b7bba894cf31769a
      size: 1226
    - path: results/cross-time-RRR.pickle
      hash: md5
      md5: bb09d002bde6277f856e3b8381b5b4e3
      size: 36064
    params:
      params.yaml:
        rrr-param-search:
          cv:
          - 3
          rank:
          - 14
          lag:
          - 100
          - 105
          - 110
          - 115
          - 120
          - 125
          - 130
          - 135
          - 140
          - 145
          - 150
          timepoints:
          - 0
          duration: 0.25
          time-bin: 0.05
          time-step: 0.025
    outs:
    - path: figures/cross-time-RRR.png
      hash: md5
      md5: 23a4bf7827deb7daf60a2cdf5693abf4
      size: 91316
  layer-assignment:
    cmd: python3 -u layer-assignment-analysis.py
    deps:
    - path: data/ccf_volumes/
      hash: md5
      md5: e0cb9ef7140957722e4c2d7453290ab0.dir
      size: 2851845665
      nfiles: 3
    - path: layer-assignment-analysis.py
      hash: md5
      md5: 2778177582c89fe37b1d01348741e585
      size: 1430
    params:
      params.yaml:
        load:
          session: 0
          areas:
          - VISp
          - VISl
          stimulus-block: natural_scenes
          step-size: 0.001
          stimulus-duration: 0.25
    outs:
    - path: data/units/
      hash: md5
      md5: bae13c27578d80797c7a86c55f82a995.dir
      size: 3644
      nfiles: 2
  stat:
    cmd: python3 -u layer-interaction-maxValues.py
    deps:
    - path: data/units/
      hash: md5
      md5: a54ece4209fd2669668f7791fdcc0e62.dir
      size: 7748
      nfiles: 2
    - path: layer-interaction-maxValues.py
      hash: md5
      md5: ab719e25308500ea24eef085b4d95f3c
      size: 3516
    - path: results/layer-interaction_LM-to-V1.pickle
      hash: md5
      md5: 7f8d2901a8861e7f193db612fb7fa3c0
      size: 52322
    - path: results/layer-interaction_V1-to-LM.pickle
      hash: md5
      md5: d24c026a381c3d73b72bed09c02e049f
      size: 52322
    params:
      params.yaml:
        crosstime:
          scaling-factor: 10
        load:
          session: 1108334384
          areas:
          - VISp
          - VISl
          stimulus-block: 5
          step-size: 0.001
          stimulus-duration: 0.25
