
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../pca/">
      
      
        <link rel="next" href="../cca/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.32">
    
    
      
        <title>Reduced Rank Regression along Time - Allen Project Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reduced-rank-regression-along-time" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Allen Project Documentation" class="md-header__button md-logo" aria-label="Allen Project Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Allen Project Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reduced Rank Regression along Time
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Allen Project Documentation" class="md-nav__button md-logo" aria-label="Allen Project Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Allen Project Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../DVC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DVC Framework
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notion/Allen%20project%20d3cfe5aab8384495b58fba8a47eeadcc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment History
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    References
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../references/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Experiments
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Experiments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../layer-rank/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Layer Ranks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../layer-interaction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Layer Interaction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiple-timeslices-layers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple Time Slices: Layers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiple-timeslices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple Time Slices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rrr-time-slice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reduced Rank Regression Time Slice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crosstime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crosstime
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../time-lag-search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time lag search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cv-time-lag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross-Validation-fold, Time-lag, and Rank search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rrr-score-time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reduced Rank Regression (RRR) Score-Time Plot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cv-rank-time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross-Validation-fold Exploration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lag-along-time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lag along Time
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rank-along-time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rank Along Time
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../control-models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Control Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rrr-rank/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reduced Rank Regression Rank Optimization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../time-lag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time-lag search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../histograms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Histograms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pca/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Principal Component Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Reduced Rank Regression along Time
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Reduced Rank Regression along Time
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rrr_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      rrr_analysis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plot" class="md-nav__link">
    <span class="md-ellipsis">
      Plot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rrr_plot" class="md-nav__link">
    <span class="md-ellipsis">
      rrr_plot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    <span class="md-ellipsis">
      Tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr" class="md-nav__link">
    <span class="md-ellipsis">
      rrr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.RFE_CV" class="md-nav__link">
    <span class="md-ellipsis">
      RFE_CV
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.RRRR" class="md-nav__link">
    <span class="md-ellipsis">
      RRRR
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.calculate_cross_time_correlation" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_cross_time_correlation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.compare_two_areas" class="md-nav__link">
    <span class="md-ellipsis">
      compare_two_areas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.control_models" class="md-nav__link">
    <span class="md-ellipsis">
      control_models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.cross_time_rrr_coeffs" class="md-nav__link">
    <span class="md-ellipsis">
      cross_time_rrr_coeffs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.crosstime_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      crosstime_analysis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.getCoeffs" class="md-nav__link">
    <span class="md-ellipsis">
      getCoeffs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.rrr_rank_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      rrr_rank_analysis
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cca/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Canonical Correlation Analysis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/data-io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data I/O
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/direct-download/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Direct Download
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/neuropixel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Preprocessing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/ccf-volumes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CCF Volumes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Important Utility Tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/plots/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plots
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/megaplot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Megaplot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/other-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Other Utility Tools
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rrr_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      rrr_analysis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plot" class="md-nav__link">
    <span class="md-ellipsis">
      Plot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rrr_plot" class="md-nav__link">
    <span class="md-ellipsis">
      rrr_plot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    <span class="md-ellipsis">
      Tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr" class="md-nav__link">
    <span class="md-ellipsis">
      rrr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.RFE_CV" class="md-nav__link">
    <span class="md-ellipsis">
      RFE_CV
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.RRRR" class="md-nav__link">
    <span class="md-ellipsis">
      RRRR
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.calculate_cross_time_correlation" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_cross_time_correlation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.compare_two_areas" class="md-nav__link">
    <span class="md-ellipsis">
      compare_two_areas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.control_models" class="md-nav__link">
    <span class="md-ellipsis">
      control_models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.cross_time_rrr_coeffs" class="md-nav__link">
    <span class="md-ellipsis">
      cross_time_rrr_coeffs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.crosstime_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      crosstime_analysis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.getCoeffs" class="md-nav__link">
    <span class="md-ellipsis">
      getCoeffs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyses.rrr.rrr_rank_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      rrr_rank_analysis
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="reduced-rank-regression-along-time">Reduced Rank Regression along Time</h1>
<p>See <a href="../../../notion/Allen%20project%20d3cfe5aab8384495b58fba8a47eeadcc/#rrr-analysis-along-time">experiment history</a> for more information.</p>
<h2 id="analysis">Analysis</h2>


<div class="doc doc-object doc-module">



<a id="rrr_analysis"></a>
    <div class="doc doc-contents first">

      <p>This code will make a CCA analysis across two brain region (VISp and VISpm) from the allen cache databese using allensdk cache and the data/.vbn_s3_cache</p>
<p>The functions for the analysis are in the cca.py and in the utils folder (e.g. download_allen.py and neuropixel.py) </p>
<p>Utile functions:</p>
<ul>
<li>from allensdk.brain_observatory.ecephys.visualization import plot_mean_waveforms, plot_spike_counts, raster_plot</li>
</ul>
<p><strong>Parameters</strong>:</p>
<ul>
<li><code>preprocess</code>:<ul>
<li><code>stimulus-block</code>: The name of the stimulus block to analyze.</li>
</ul>
</li>
</ul>
<p><strong>Input</strong>:</p>
<ul>
<li><code>data/area-responses/&lt;stimulus-block&gt;_block_VISp-responses.pickle</code>: Pickle file containing the responses of the units in the VISp area.</li>
<li><code>data/area-responses/&lt;stimulus-block&gt;_block_VISpm-responses.pickle</code>: Pickle file containing the responses of the units in the VISpm area.</li>
</ul>
<p><strong>Output</strong>:</p>
<ul>
<li><code>results/rrr.pickle</code>: Pickle file containing the results of the RRR analysis.</li>
</ul>
<p><strong>Submodules</strong>:</p>
<ul>
<li><code>analyses.rrr</code>: Module for the RRR analysis.</li>
<li><code>utils.data_io</code>: Module for loading and saving data.</li>
<li><code>utils.download_allen</code>: Module for downloading data from the Allen Institute API.</li>
</ul>



  <div class="doc doc-children">











  </div>

    </div>

</div><h2 id="plot">Plot</h2>


<div class="doc doc-object doc-module">



<a id="rrr_plot"></a>
    <div class="doc doc-contents first">

      <p>This module plots the RRR results.</p>
<p><strong>Parameters</strong>:</p>
<ul>
<li><code>rrr</code>: RRR parameters.</li>
<li><code>preprocess</code>: Preprocess parameters.</li>
</ul>
<p><strong>Input</strong>:</p>
<ul>
<li><code>results/rrr_coefficients.pickle</code>: RRR coefficients.</li>
</ul>
<p><strong>Output</strong>:</p>
<ul>
<li><code>figures/VISl-VISp_block-&lt;stimulus-block&gt;_rrr-coefficients_along_time.png</code>: Plot of the RRR coefficients along time.</li>
</ul>
<p><strong>Submodules</strong>:</p>
<ul>
<li><code>utils.data_io</code>: Module for loading and saving data.</li>
<li><code>utils.plots</code>: Module for plotting data.</li>
</ul>



  <div class="doc doc-children">











  </div>

    </div>

</div><h2 id="tools">Tools</h2>


<div class="doc doc-object doc-module">



<a id="analyses.rrr"></a>
    <div class="doc doc-contents first">

      <p>This module contains tools for performing Reduced Rank Regression (RRR) analysis on neural data.</p>
<p>Functions:</p>
<ul>
<li>getCoeffs(model, log=False) -&gt; numpy.ndarray: Calculate the mean coefficients of a model over cross-validation folds.</li>
<li>RRRR(X_data, Y_data, dataBalancing='none', rank=None, cv=None, log=False, success_log=True, warn=True) -&gt; dict: Make Reduced Rank Regression (RRR) analysis.</li>
<li>RFE_CV(X_data, Y_data, rank=None, cv=None) -&gt; dict: Perform Recursive Feature Elimination (RFE) cross-validation.</li>
<li>compare_two_areas(area_X_responses:np.ndarray, area_Y_responses:np.ndarray, log=False) -&gt; dict: Compare the responses of units in two brain areas using Reduced Rank Regression (RRR).</li>
<li>control_models(predictor_names=['V1', 'movement', 'pupil'], response_name='V2', log=False) -&gt; np.ndarray: Perform control models analysis using Reduced Rank Regression (RRR).</li>
<li>rrr_rank_analysis(V1_activity, V2_activity, max_rank=15, cv=params['cv'], log=False) -&gt; np.ndarray: Perform Reduced Rank Regression (RRR) rank analysis.</li>
<li>calculate_cross_time_correlation(areaX, areaY, log=False) -&gt; np.ndarray: Calculate the cross-time correlation RRR between the responses of two brain areas.</li>
<li>cross_time_rrr_coeffs(V1_activity, V2_activity, cv=None, rank=None) -&gt; np.ndarray: Calculate the cross-time RRR coefficients between two sets of activities.</li>
<li>crosstime_analysis(predictor, target, cv, rank, scaling_factor=10, dataBalancing='none', ProgressBar=True) -&gt; np.ndarray: Perform cross-time analysis based on timpoints of rrr-param-search lag.</li>
</ul>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="analyses.rrr.RFE_CV" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">RFE_CV</span><span class="p">(</span><span class="n">X_data</span><span class="p">,</span> <span class="n">Y_data</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Performs Recursive Feature Elimination (RFE) with cross-validation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>X_data</code></td>
            <td>
                  <code>array - like</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>Y_data</code></td>
            <td>
                  <code>array - like</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>rank</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of features to select. If not provided, the default value from params will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cv</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of cross-validation folds. If not provided, the default value from params will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>optimal_features</code></td>            <td>
                  <code>array - like</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The selected optimal features.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>analyses/rrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">RFE_CV</span><span class="p">(</span><span class="n">X_data</span><span class="p">,</span> <span class="n">Y_data</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs Recursive Feature Elimination (RFE) with cross-validation.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        X_data (array-like): The input data.</span>
<span class="sd">        Y_data (array-like): The target data.</span>
<span class="sd">        rank (int, optional): The number of features to select. If not provided, the default value from params will be used.</span>
<span class="sd">        cv (int, optional): The number of cross-validation folds. If not provided, the default value from params will be used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        optimal_features (array-like): The selected optimal features.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set default values</span>
    <span class="k">if</span> <span class="n">rank</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cv&#39;</span><span class="p">]</span>

    <span class="c1"># Make RFE model</span>
    <span class="n">optimal_features</span> <span class="o">=</span> <span class="n">custom_feature_selection</span><span class="p">(</span><span class="n">X_data</span><span class="p">,</span> <span class="n">Y_data</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">optimal_features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="analyses.rrr.RRRR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">RRRR</span><span class="p">(</span><span class="n">X_data</span><span class="p">,</span> <span class="n">Y_data</span><span class="p">,</span> <span class="n">dataBalancing</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">success_log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Make Reduced Rank Regression (RRR) analysis.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>X_data</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data of the first brain area. Shape (n_samples, n_features_X)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>Y_data</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data of the second brain area. Shape (n_samples, n_features_Y)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dataBalancing</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of the RRR analysis. Either 'none' or 'undersampled'. Defaults to 'none'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;none&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>log</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to log the progress. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>rank</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rank of the RRR model. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cv</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of cross-validation folds. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the results of the RRR analysis.
mean_coefficients (np.ndarray): The mean coefficients of the RRR model. Shape (n_features_X, n_features_Y)
test_score (np.ndarray): The test scores of the RRR model. Shape (n_splits,)
estimator (np.ndarray): The estimators of the RRR model. Shape (n_splits,)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>analyses/rrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">RRRR</span><span class="p">(</span><span class="n">X_data</span><span class="p">,</span> <span class="n">Y_data</span><span class="p">,</span> <span class="n">dataBalancing</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">success_log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make Reduced Rank Regression (RRR) analysis.</span>

<span class="sd">    Args:</span>
<span class="sd">        X_data (np.ndarray): The data of the first brain area. Shape (n_samples, n_features_X)</span>
<span class="sd">        Y_data (np.ndarray): The data of the second brain area. Shape (n_samples, n_features_Y)</span>
<span class="sd">        dataBalancing (str, optional): The type of the RRR analysis. Either &#39;none&#39; or &#39;undersampled&#39;. Defaults to &#39;none&#39;.</span>
<span class="sd">        log (bool, optional): Whether to log the progress. Defaults to True.</span>
<span class="sd">        rank (int, optional): The rank of the RRR model. Defaults to None.</span>
<span class="sd">        cv (int, optional): The number of cross-validation folds. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the results of the RRR analysis.</span>
<span class="sd">            mean_coefficients (np.ndarray): The mean coefficients of the RRR model. Shape (n_features_X, n_features_Y)</span>
<span class="sd">            test_score (np.ndarray): The test scores of the RRR model. Shape (n_splits,)</span>
<span class="sd">            estimator (np.ndarray): The estimators of the RRR model. Shape (n_splits,)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set default values</span>
    <span class="k">if</span> <span class="n">rank</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cv&#39;</span><span class="p">]</span>

    <span class="c1"># Make RRR model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">ReducedRankRidgeRegression</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">)</span>

    <span class="c1"># Set the undersampling sample size</span>
    <span class="n">sample_size</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sample-size&#39;</span><span class="p">]</span>

    <span class="c1"># Perform cross-validation</span>
    <span class="k">if</span> <span class="n">dataBalancing</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_data</span><span class="p">,</span> <span class="n">Y_data</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">return_estimator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dataBalancing</span> <span class="o">==</span> <span class="s1">&#39;undersampled&#39;</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">undersampled_cross_validation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_data</span><span class="p">,</span> <span class="n">Y_data</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">k_folds</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="n">warn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid type. Use either &quot;none&quot; or &quot;undersampled&quot;.&#39;</span><span class="p">)</span>

    <span class="c1"># Log the cross-validation scores</span>
    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cross-validation scores:&#39;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">])</span>

    <span class="c1"># Get the coefficients</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mean_coefficients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">getCoeffs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;estimator&#39;</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>

    <span class="c1"># Get the adjusted R2 score</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;adjusted_r2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">Y_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Y_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">X_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R2:&#39;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adjusted R2:&#39;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;adjusted_r2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="c1"># If mean of the scores is not negative, then print the cv, rank and the mean of the scores</span>
    <span class="k">if</span> <span class="n">success_log</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;CV: </span><span class="si">{</span><span class="n">cv</span><span class="si">}</span><span class="s1">, Rank: </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s1">, Mean test score: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;test_score&quot;</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Negative scores are not meaningful, so set them to nan</span>
    <span class="c1"># results[&#39;test_score&#39;][results[&#39;test_score&#39;] &lt; 0] = np.nan</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="analyses.rrr.calculate_cross_time_correlation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_cross_time_correlation</span><span class="p">(</span><span class="n">areaX</span><span class="p">,</span> <span class="n">areaY</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Calculate the cross-time correlation RRR between the responses of two brain areas. The output will be a matrix of shape (T, T) where T is the number of time points.</p>

            <details class="quote">
              <summary>Source code in <code>analyses/rrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_cross_time_correlation</span><span class="p">(</span><span class="n">areaX</span><span class="p">,</span> <span class="n">areaY</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the cross-time correlation RRR between the responses of two brain areas. The output will be a matrix of shape (T, T) where T is the number of time points.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get the number of neurons, trials, and time points</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">areaX</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># Initialize the cross-time correlation coefficients</span>
    <span class="n">cross_time_r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>

    <span class="c1"># Iterate over time</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">areaX</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">areaY</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

            <span class="c1"># Calculate rrr ridge using your rrrr function</span>
            <span class="n">models</span> <span class="o">=</span> <span class="n">RRRR</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;cv&#39;</span><span class="p">])</span>

            <span class="c1"># Calculate the mean of the test scores above the cv-folds</span>
            <span class="n">cross_time_r2</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cross_time_r2</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">cross_time_r2</span><span class="p">)</span>

    <span class="c1"># The values must be nan where the time of V1 is greater than V2</span>
    <span class="n">cross_time_r2</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">tril_indices</span><span class="p">(</span><span class="n">cross_time_r2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># The negative values must be nan, because they are not meaningful</span>
    <span class="n">cross_time_r2</span><span class="p">[</span><span class="n">cross_time_r2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">return</span> <span class="n">cross_time_r2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="analyses.rrr.compare_two_areas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compare_two_areas</span><span class="p">(</span><span class="n">area_X_responses</span><span class="p">,</span> <span class="n">area_Y_responses</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Compare the responses of units in two brain areas using Reduced Rank Regression (RRR).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>area_X_responses</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The responses of units in the first brain area. Shape (n_units_X, n_trials, n_timepoints)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>area_Y_responses</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The responses of units in the second brain area. Shape (n_units_Y, n_trials, n_timepoints)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>log</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to log the progress. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>return</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the results of the RRR analysis.
coefficients (np.ndarray): The coefficients of the RRR model. Shape (n_units_X, n_units_Y, n_timepoints)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>analyses/rrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compare_two_areas</span><span class="p">(</span><span class="n">area_X_responses</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">area_Y_responses</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare the responses of units in two brain areas using Reduced Rank Regression (RRR).</span>

<span class="sd">    Parameters:</span>
<span class="sd">        area_X_responses (np.ndarray): The responses of units in the first brain area. Shape (n_units_X, n_trials, n_timepoints)</span>
<span class="sd">        area_Y_responses (np.ndarray): The responses of units in the second brain area. Shape (n_units_Y, n_trials, n_timepoints)</span>
<span class="sd">        log (bool, optional): Whether to log the progress. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        return (dict): A dictionary containing the results of the RRR analysis.</span>
<span class="sd">            coefficients (np.ndarray): The coefficients of the RRR model. Shape (n_units_X, n_units_Y, n_timepoints)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Parameters</span>
    <span class="n">binSize</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">[</span><span class="s1">&#39;bin-size&#39;</span><span class="p">]</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">[</span><span class="s1">&#39;stimulus-duration&#39;</span><span class="p">]</span>
    <span class="n">time_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="o">/</span><span class="n">binSize</span><span class="p">)</span>
    <span class="n">n_area_X_units</span><span class="p">,</span> <span class="n">n_area_Y_units</span> <span class="o">=</span> <span class="n">area_X_responses</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">area_Y_responses</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Make RRR</span>
    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Make RRR...&#39;</span><span class="p">)</span>
    <span class="n">coefficients</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_area_X_units</span><span class="p">,</span> <span class="n">n_area_Y_units</span><span class="p">,</span> <span class="n">time_length</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">time_length</span><span class="p">):</span>
        <span class="n">coefficients</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">time</span><span class="p">]</span><span class="o">=</span> <span class="n">RRRR</span><span class="p">(</span><span class="n">area_X_responses</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">area_Y_responses</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;coefficients.shape&#39;</span><span class="p">,</span> <span class="n">coefficients</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;coefficients&#39;</span><span class="p">:</span> <span class="n">coefficients</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="analyses.rrr.control_models" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">control_models</span><span class="p">(</span><span class="n">predictor_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="s1">&#39;movement&#39;</span><span class="p">,</span> <span class="s1">&#39;pupil&#39;</span><span class="p">],</span> <span class="n">response_name</span><span class="o">=</span><span class="s1">&#39;V2&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Perform control models analysis using Reduced Rank Regression (RRR).</p>
<p>This function loads the necessary data, transforms the behavioral data to match the neuronal data,
and performs RRR analysis at each time point. The analysis is performed using the V1 neuronal activity
as predictors and V2 neuronal activity as the target variable. The behavioral data (movement and pupil)
can also be included as predictors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>predictor_names</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Define, which data to concatenate into the predictors. The options are: 'V1', 'movement', 'pupil'.</p>
              </div>
            </td>
            <td>
                  <code>[&#39;V1&#39;, &#39;movement&#39;, &#39;pupil&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>response_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the outcome variable. Default is 'V2'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;V2&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>log</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to log the progress. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>results</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of shape (T, cv) containing the RRR test scores at each time point.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>analyses/rrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">control_models</span><span class="p">(</span><span class="n">predictor_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="s1">&#39;movement&#39;</span><span class="p">,</span> <span class="s1">&#39;pupil&#39;</span><span class="p">],</span> <span class="n">response_name</span><span class="o">=</span><span class="s1">&#39;V2&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Perform control models analysis using Reduced Rank Regression (RRR).</span>

<span class="sd">    This function loads the necessary data, transforms the behavioral data to match the neuronal data,</span>
<span class="sd">    and performs RRR analysis at each time point. The analysis is performed using the V1 neuronal activity</span>
<span class="sd">    as predictors and V2 neuronal activity as the target variable. The behavioral data (movement and pupil)</span>
<span class="sd">    can also be included as predictors.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        predictor_names (list): Define, which data to concatenate into the predictors. The options are: &#39;V1&#39;, &#39;movement&#39;, &#39;pupil&#39;.</span>
<span class="sd">        response_name (str): The name of the outcome variable. Default is &#39;V2&#39;.</span>
<span class="sd">        log (bool): Whether to log the progress. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        results (numpy.ndarray): Array of shape (T, cv) containing the RRR test scores at each time point.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Load the data</span>
    <span class="n">V1</span> <span class="o">=</span> <span class="n">load_pickle</span><span class="p">(</span><span class="s2">&quot;5_block_VISp-activity&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/area-responses&quot;</span><span class="p">)</span> <span class="c1"># shape (Neurons, Trials, Time)</span>
    <span class="n">V2</span> <span class="o">=</span> <span class="n">load_pickle</span><span class="p">(</span><span class="s2">&quot;5_block_VISl-activity&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/area-responses&quot;</span><span class="p">)</span> <span class="c1"># shape (Neurons, Trials, Time)</span>
    <span class="n">movement</span> <span class="o">=</span> <span class="n">load_pickle</span><span class="p">(</span><span class="s2">&quot;5_block_running-speed&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/behav-responses&quot;</span><span class="p">)</span> <span class="c1"># shape (Trials, Time)</span>
    <span class="n">pupil</span> <span class="o">=</span> <span class="n">load_pickle</span><span class="p">(</span><span class="s2">&quot;5_block_pupil-area&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/behav-responses&quot;</span><span class="p">)</span> <span class="c1"># shape (Trials, Time)</span>

    <span class="c1"># Transform the behav data to amtch the V1 and V2 data</span>
    <span class="n">movement</span> <span class="o">=</span> <span class="n">movement</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">pupil</span> <span class="o">=</span> <span class="n">pupil</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

    <span class="c1"># Get the number of neurons, trials, and time</span>
    <span class="n">N_1</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">V1</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">N_2</span> <span class="o">=</span> <span class="n">V2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;V1 shape: </span><span class="si">{</span><span class="n">V1</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, V2 shape: </span><span class="si">{</span><span class="n">V2</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, movement shape: </span><span class="si">{</span><span class="n">movement</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, pupil shape: </span><span class="si">{</span><span class="n">pupil</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Init the results bs shape (T, cv)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;cv&#39;</span><span class="p">],</span> <span class="n">T</span><span class="p">))</span>

    <span class="c1"># Loop through the time</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>

        <span class="c1"># Make DataFrame from the data</span>
        <span class="n">X_V1</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">V1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;V1_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">V1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
        <span class="n">X_mov</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">movement</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;movement&#39;</span><span class="p">])</span>
        <span class="n">X_pup</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pupil</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pupil&#39;</span><span class="p">])</span>
        <span class="n">Y_V2</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">V2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;V2_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">V2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>

        <span class="c1"># Calculate mean values</span>
        <span class="n">X_V1_mean</span> <span class="o">=</span> <span class="n">X_V1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">X_mov_mean</span> <span class="o">=</span> <span class="n">X_mov</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">X_pup_mean</span> <span class="o">=</span> <span class="n">X_pup</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">Y_V2_mean</span> <span class="o">=</span> <span class="n">Y_V2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># If any of the mean values are NaN, print a warning specifying which one</span>
        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">X_V1_mean</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X_V1_mean contains NaNs&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">X_mov_mean</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X_mov_mean contains NaNs&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">X_pup_mean</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X_pup_mean contains NaNs&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Y_V2_mean</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y_V2_mean contains NaNs&#39;</span><span class="p">)</span>

        <span class="c1"># Replace the NaNs with the mean</span>
        <span class="n">X_V1</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">X_V1_mean</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">X_mov</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">X_mov_mean</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">X_pup</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">X_pup_mean</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Y_V2</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">Y_V2_mean</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Create a dictionary of the dataframes</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;V1&#39;</span><span class="p">:</span> <span class="n">X_V1</span><span class="p">,</span> <span class="s1">&#39;movement&#39;</span><span class="p">:</span> <span class="n">X_mov</span><span class="p">,</span> <span class="s1">&#39;pupil&#39;</span><span class="p">:</span> <span class="n">X_pup</span><span class="p">,</span> <span class="s1">&#39;V2&#39;</span><span class="p">:</span> <span class="n">Y_V2</span><span class="p">}</span>

        <span class="c1"># Create a list from the dataframes if they are listed in the predictor names list</span>
        <span class="n">predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">predictor_names</span><span class="p">]</span>

        <span class="c1"># Concatenate the data</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">predictors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># Get the outcome variable</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="n">response_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># if x contains nan, raise an error</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;X contains NaNs&#39;</span><span class="p">)</span>

        <span class="c1"># Make Reduced Rank Reegression</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">RRRR</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;cv&#39;</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>

        <span class="c1"># Append the scores to the results</span>
        <span class="n">results</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="analyses.rrr.cross_time_rrr_coeffs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cross_time_rrr_coeffs</span><span class="p">(</span><span class="n">V1_activity</span><span class="p">,</span> <span class="n">V2_activity</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Calculate the cross-time RRR coefficients between two sets of activities.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>V1_activity</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of activities for the first set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>V2_activity</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of activities for the second set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Array of cross-time RRR coefficients. Shape (timelength_X, timelength_Y)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>analyses/rrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cross_time_rrr_coeffs</span><span class="p">(</span><span class="n">V1_activity</span><span class="p">,</span> <span class="n">V2_activity</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the cross-time RRR coefficients between two sets of activities.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        V1_activity (np.ndarray): Array of activities for the first set.</span>
<span class="sd">        V2_activity (np.ndarray): Array of activities for the second set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Array of cross-time RRR coefficients. Shape (timelength_X, timelength_Y)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">RRRR</span><span class="p">(</span><span class="n">V1_activity</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">V2_activity</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="analyses.rrr.crosstime_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">crosstime_analysis</span><span class="p">(</span><span class="n">predictor</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">scaling_factor</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">dataBalancing</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ProgressBar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Perform cross-time analysis based on timpoints of rrr-param-search lag.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>predictor</code></td>
            <td>
                  <code>ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of shape (neurons, trials, timepoints) representing the activity of the predictor area.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>target</code></td>
            <td>
                  <code>ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of shape (neurons, trials, timepoints) representing the activity of the target area.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cv</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of cross-validation folds to use.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>rank</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rank of the reduced-rank regression model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scaling_factor</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scaling factor for the time points. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dataBalancing</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of data balancing to use. Defaults to 'none'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;none&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ProgressBar</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to display a progress bar. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>crosstimeMatrix</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of shape (timepoints, timepoints) representing the cross-time RRR scores.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>analyses/rrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">crosstime_analysis</span><span class="p">(</span><span class="n">predictor</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">scaling_factor</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">dataBalancing</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ProgressBar</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform cross-time analysis based on timpoints of rrr-param-search lag.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        predictor (ndarray): Array of shape (neurons, trials, timepoints) representing the activity of the predictor area.</span>
<span class="sd">        target (ndarray): Array of shape (neurons, trials, timepoints) representing the activity of the target area.</span>
<span class="sd">        cv (int): Number of cross-validation folds to use.</span>
<span class="sd">        rank (int): Rank of the reduced-rank regression model.</span>
<span class="sd">        scaling_factor (int, optional): Scaling factor for the time points. Defaults to 1.</span>
<span class="sd">        dataBalancing (str, optional): Type of data balancing to use. Defaults to &#39;none&#39;.</span>
<span class="sd">        ProgressBar (bool, optional): Whether to display a progress bar. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        crosstimeMatrix (np.ndarray): Array of shape (timepoints, timepoints) representing the cross-time RRR scores.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">predictor_orig</span> <span class="o">=</span> <span class="n">predictor</span>
    <span class="n">target_orig</span> <span class="o">=</span> <span class="n">target</span>

    <span class="c1"># Get the time bin</span>
    <span class="n">time_bin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">preprocess</span><span class="p">[</span><span class="s2">&quot;bin-size&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1"># in ms</span>

    <span class="c1"># Define the parameters</span>
    <span class="n">xseries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">scaling_factor</span><span class="p">)</span>
    <span class="n">yseries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">scaling_factor</span><span class="p">)</span>

    <span class="c1"># Init results</span>
    <span class="n">crosstimeMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xseries</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">yseries</span><span class="p">)),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="c1"># If sample_size is greater than the number of samples, then log a warning and return empty results</span>
    <span class="k">if</span> <span class="n">dataBalancing</span> <span class="o">==</span> <span class="s1">&#39;undersampled&#39;</span><span class="p">:</span>
        <span class="n">y_length</span> <span class="o">=</span> <span class="n">target_orig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sample-size&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y_length</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Waring: sample_size (</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sample-size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">) is greater than the number of samples (</span><span class="si">{</span><span class="n">y_length</span><span class="si">}</span><span class="s2">). Returning empty results.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">crosstimeMatrix</span>

    <span class="c1"># In case of undersampling lower boundary of layer 5 -&gt; do not calculate the other layers</span>
    <span class="c1"># if dataBalancing == &#39;none&#39;: # TODO: wipe this out</span>
    <span class="c1">#     return results</span>

    <span class="c1"># Print progressbar</span>
    <span class="n">progress_bar_id</span> <span class="o">=</span> <span class="s1">&#39;crosstime analysis&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ProgressBar</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">progress_bar_id</span> <span class="o">=</span> <span class="n">ProgressBar</span>
        <span class="n">ProgressBar</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">ProgressBar</span><span class="p">:</span> <span class="n">manager</span><span class="o">.</span><span class="n">progress_bar</span><span class="p">(</span><span class="n">progress_bar_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xseries</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">t_x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xseries</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span><span class="p">,</span> <span class="n">t_y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">yseries</span><span class="p">):</span>

            <span class="c1"># Preprocess the data (the trial duration is only one bin now).</span>
            <span class="n">predictor</span> <span class="o">=</span> <span class="n">preprocess_area_responses</span><span class="p">(</span><span class="n">predictor_orig</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">t_x</span> <span class="p">:</span> <span class="n">t_x</span> <span class="o">+</span> <span class="n">time_bin</span><span class="p">],</span> 
                                                  <span class="n">stimulus_duration</span><span class="o">=</span><span class="n">preprocess</span><span class="p">[</span><span class="s2">&quot;bin-size&quot;</span><span class="p">],</span> 
                                                  <span class="n">step_size</span><span class="o">=</span><span class="n">preprocess</span><span class="p">[</span><span class="s2">&quot;step-size&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="n">target</span>    <span class="o">=</span> <span class="n">preprocess_area_responses</span><span class="p">(</span><span class="n">target_orig</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">t_y</span> <span class="p">:</span> <span class="n">t_y</span> <span class="o">+</span> <span class="n">time_bin</span><span class="p">],</span> 
                                                  <span class="n">stimulus_duration</span><span class="o">=</span><span class="n">preprocess</span><span class="p">[</span><span class="s2">&quot;bin-size&quot;</span><span class="p">],</span> 
                                                  <span class="n">step_size</span><span class="o">=</span><span class="n">preprocess</span><span class="p">[</span><span class="s2">&quot;step-size&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

            <span class="c1"># Calculate the RRRR</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">RFE_CV</span><span class="p">(</span><span class="n">predictor</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>

            <span class="c1"># Save results</span>
            <span class="n">crosstimeMatrix</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>

        <span class="c1"># Print progressbar</span>
        <span class="k">if</span> <span class="n">ProgressBar</span><span class="p">:</span> <span class="n">manager</span><span class="o">.</span><span class="n">progress_bar</span><span class="p">(</span><span class="n">progress_bar_id</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xseries</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">crosstimeMatrix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="analyses.rrr.getCoeffs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getCoeffs</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Calculate the mean coefficients of a model over cross-validation folds.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>model</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of estimators representing the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>log</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to print the shape of the coefficients. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>mean_coefficients</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mean coefficients of the model.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>If the model is None, None is returned.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>analyses/rrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getCoeffs</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the mean coefficients of a model over cross-validation folds.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        model (list): A list of estimators representing the model.</span>
<span class="sd">        log (bool, optional): Whether to print the shape of the coefficients. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        mean_coefficients (numpy.ndarray): The mean coefficients of the model.</span>

<span class="sd">    Note:</span>
<span class="sd">        If the model is None, None is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># If the model is None, return None</span>
    <span class="k">if</span> <span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Concatenate the coefficients over the cross-validation folds</span>
    <span class="n">coefficients</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">estimator</span><span class="o">.</span><span class="n">coef_</span> <span class="k">for</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="n">model</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;coefficients.shape&#39;</span><span class="p">,</span> <span class="n">coefficients</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># Calculate the mean of the coefficients</span>
    <span class="n">mean_coefficients</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">coefficients</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Append the mean coefficients to the results</span>
    <span class="k">return</span> <span class="n">mean_coefficients</span><span class="o">.</span><span class="n">T</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="analyses.rrr.rrr_rank_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rrr_rank_analysis</span><span class="p">(</span><span class="n">V1_activity</span><span class="p">,</span> <span class="n">V2_activity</span><span class="p">,</span> <span class="n">max_rank</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;cv&#39;</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Perform Reduced Rank Regression (RRR) rank analysis.</p>

            <details class="quote">
              <summary>Source code in <code>analyses/rrr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rrr_rank_analysis</span><span class="p">(</span><span class="n">V1_activity</span><span class="p">,</span> <span class="n">V2_activity</span><span class="p">,</span> <span class="n">max_rank</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;cv&#39;</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform Reduced Rank Regression (RRR) rank analysis.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get the number of neurons, trials, and time points</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">K_V1</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">V1_activity</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># Define the range of ranks to iterate over</span>
    <span class="n">ranks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_rank</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Initialize the errors</span>
    <span class="n">test_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">max_rank</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>

    <span class="c1"># Iterate over time</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="n">ranks</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">V1_activity</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">V2_activity</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

            <span class="c1"># Calculate rrr ridge using your rrrr function</span>
            <span class="n">models</span> <span class="o">=</span> <span class="n">RRRR</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>

            <span class="c1"># Calculate the mean of the test scores above the cv-folds</span>
            <span class="n">test_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">])</span>

            <span class="c1"># Save the test score</span>
            <span class="n">test_scores</span><span class="p">[</span><span class="n">rank</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_score</span>

            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rank: </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">, Time: </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, Test Score: </span><span class="si">{</span><span class="n">test_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># If test scores are negative, set them to nan</span>
    <span class="n">test_scores</span><span class="p">[</span><span class="n">test_scores</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">return</span> <span class="n">test_scores</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.471ce7a9.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>